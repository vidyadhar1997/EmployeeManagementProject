<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Welcome To Employee management</title>
    <link rel="stylesheet" href="/css/WelcomePage.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
</head>
<body>
    <div class="topDiv">
        <div class="headdiv" align="center">
            <h2>Welcome To Employee management</h2>
        </div>
        <div class="menubar">

            <a href="WelcomePage.html"><label id="home"><b>HOME</b></label></a>

            <a href="ResetPassword.html"><label><b>RESET PASSWORD</b></label></a>

            <a href="login.html"><label id="logout"><b>LOGOUT</b></label></a>

        </div>
    </div>
    <table id="employee">
        <tbody>
            <tr>
                <th>Employee Id</th>
                <th>First name</th>
                <th>Last name</th>
                <th>Email</th>
                <th>Password</th>
                <th>Phone Number</th>
                <th>Address</th>
                <th>City</th>
                <th>State</th>
                <th>Zip</th>
                <th>Edit</th>
                <th>Delete</th>
            </tr>
        </tbody>
    </table>
    <div class="modal fade" id="myModal" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Employee Details for Updation</h4>
                </div>
                <div class="modal-body" style="padding-left: 70px;">
                    <form name="myForm" style="">
                        <div class="form-group row">
                            <label for="EmployeeId" class="col-md-4 col-form-label text-md-left">Employee Id</label>
                            <div class="col-md-6">
                                <input type="text" id="empId" class="form-control" name="EmployeeId" placeholder="EmployeeId">
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="first-name" class="col-md-4 col-form-label text-md-left">First Name</label>
                            <div class="col-md-6">
                                <input type="text" id="firstName" class="form-control" name="firstName" placeholder="First name">
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="lastName" class="col-md-4 col-form-label text-md-left">Last Name</label>
                            <div class="col-md-6">
                                <input type="text" id="lastName" class="form-control" name="lastName" placeholder="Last name">
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="Emial" class="col-md-4 col-form-label text-md-left">Email</label>
                            <div class="col-md-6">
                                <input type="text" id="Emial" class="form-control" name="Email" placeholder="Email">
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="Password" class="col-md-4 col-form-label text-md-left">Password</label>
                            <div class="col-md-6">
                                <input type="text" id="Password" class="form-control" name="Password" placeholder="Password">
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="PhoneNumber" class="col-md-4 col-form-label text-md-left">Phone Number</label>
                            <div class="col-md-6">
                                <input type="text" id="PhoneNumber" class="form-control" name="PhoneNumber" placeholder="Phone number">
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="Address" class="col-md-4 col-form-label text-md-left">Address</label>
                            <div class="col-md-6">
                                <input type="text" id="Address" class="form-control" name="Address" placeholder="Address">
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="City" class="col-md-4 col-form-label text-md-left">City</label>
                            <div class="col-md-6">
                                <input type="text" id="City" class="form-control" name="City" placeholder="City">
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="State" class="col-md-4 col-form-label text-md-left">State</label>
                            <div class="col-md-6">
                                <input type="text" id="State" class="form-control" name="State" placeholder="State">
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="Zip" class="col-md-4 col-form-label text-md-left">Zip</label>
                            <div class="col-md-6">
                                <input type="number" id="Zip" class="form-control" name="Zip" placeholder="Zip">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <input type="button" class="btn btn-primary" id="btnUpdateEmployee" value="Update">
                    <input type="button" class="btn btn-danger" data-dismiss="modal" value="Cancle">
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script type="text/javascript">

        $(document).ready(function () {
            $.ajax({
                type: "GET",
                url: "/api/getEmployee",
                success: function (data) {
                    var employeeTable = $("#employee tbody");
                    $(data).each(function (i, item) {
                        employeeTable.append(
                            "<tr><td> " + item.employeeId + "</td >"
                            + "<td> " + item.firstName + "</td > "
                            + "<td> " + item.lastName + "</td > "
                            + "<td> " + item.email + "</td > "
                            + "<td> " + item.password + "</td> "
                            + "<td> " + item.phoneNumber + "</td > "
                            + "<td> " + item.address + "</td > "
                            + "<td> " + item.city + "</td> "
                            + "<td> " + item.state + "</td > "
                            + "<td> " + item.zip + "</td > "
                            + '<td ><button type=button id=edit' + item.employeeId + ' class="btn btn-primary"  onclick= editTable(' + item.employeeId + ') value=Edit data-toggle="modal" data-target="#myModal">Edit</button> </td>'
                            + '<td ><a href= WelcomePage.html></a><input type=button name=Delete id=delete onclick=myfunction(' + item.employeeId + ') value=Delete></td>'
                            + "</tr> "
                        )

                    });
                }
            });
        });

        function myfunction(EmployeeId) {
            $(function () {
                $("#delete").click(function () {
                    console.log("suraj");
                    $.ajax({
                        type: "DELETE",
                        url: "/api/deletedEmployee",
                        data: { 'id': EmployeeId },
                        success: function (data) {
                            alert("Data has been deleted successfully.")
                            window.location.reload();
                            return true;
                        },
                        error: function () {
                            alert("Error while deleting employeedata");
                        }
                    });
                });
            });
        }

        function editTable(EmployeeId) {
            $(function () {
                $("#edit" + EmployeeId).click(function () {
                    $.ajax({
                        type: "Get",
                        url: "/api/EmployeeDetails",
                        data: { 'id': EmployeeId },
                        dataType: "Json",
                        processData: true,
                        success: function (data) {
                            $(data).each(function (i, item) {
                                $("#empId").val(item.employeeId);
                                $("#firstName").val(item.firstName);
                                $("#lastName").val(item.lastName);
                                $("#Emial").val(item.email);
                                $("#Password").val(item.password);
                                $("#PhoneNumber").val(item.phoneNumber);
                                $("#Address").val(item.address);
                                $("#City").val(item.city);
                                $("#State").val(item.state);
                                $("#Zip").val(item.zip);
                                return true;
                            });
                        },
                        error: function () {
                            alert("Error while fetching employee details");
                        }
                    });
                });
            });
        }

        $(function () {
            $("#btnUpdateEmployee").click(function () {
                var emailRegex = /^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i
                var passwordRegex = /^[A-Za-z0-9!@#$%^&*()_]{6,20}$/;
                var firstNameRegex = /^[A-Z]{1}[a-z]{2,}$/;
                var lastNameRegex = /^[A-Z]{1}[a-z]{2,}$/;
                var phoneNumberRegex = /^[0-9]{2}[ ][0-9]{10}$/;
                var Address = document.myForm.Address.value;
                var City = document.myForm.City.value;
                var State = document.myForm.State.value;
                var Zip = document.myForm.Zip.value;
                var Password = document.myForm.Password.value;
                if (!firstNameRegex.test(document.myForm.firstName.value)) {
                    alert("Error:First name start with Capital letter");
                    document.myForm.FirstName.focus();
                    return false;
                } else if (!lastNameRegex.test(document.myForm.lastName.value)) {
                    alert("Error:Last name start with Capital letter ");
                    document.myForm.LastName.focus();
                    return false;
                } else if (!emailRegex.test(document.myForm.Email.value)) {
                    alert("Error: please enter the valid email");
                    document.myForm.email.focus();
                    return false;
                } else if (!passwordRegex.test(document.myForm.Password.value)) {
                    alert("Error: password must contain at least one lowercase letter (a-z)!");
                    document.myForm.password.focus();
                    return false;
                } else if (!phoneNumberRegex.test(document.myForm.PhoneNumber.value)) {
                    alert("Error: Phone number must be 10 character");
                    document.myForm.PhoneNumber.focus();
                    return false;
                } else if (Address == null || Address == "") {
                    alert("Error:Address filed should not be empty ");
                    document.myForm.Address.focus();
                    return false;
                }
                else if (City == null || City == "") {
                    alert("Error:City filed should not be empty ");
                    document.myForm.City.focus();
                    return false;
                }
                else if (State == null || State == "") {
                    alert("Error:State filed should not be empty ");
                    document.myForm.State.focus();
                    return false;
                } else if (Zip == null || Zip == "") {
                    alert("Error:Zip filed should not be empty ");
                    document.myForm.Zip.focus();
                    return false;
                }
                console.log("dk");
                var employeess = {};
                employeess.EmployeeId = $("#empId").val();
                employeess.FirstName = $("#firstName").val();
                employeess.LastName = $("#lastName").val();
                employeess.Email = $("#Emial").val();
                employeess.Password = $("#Password").val();
                employeess.PhoneNumber = $("#PhoneNumber").val();
                employeess.Address = $("#Address").val();
                employeess.City = $("#City").val();
                employeess.State = $("#State").val();
                employeess.Zip = $("#Zip").val();
                console.log(JSON.stringify(employeess));
                $.ajax({
                    type: "PUT",
                    url: "/api/UpdateEmployee",
                    data: JSON.stringify(employeess),
                    dataType: "",
                    contentType: "application/json; charset=utf-8",
                    processData: true,
                    success: function () {
                        alert("Employee Data Updated successfully.");
                        window.location.reload();
                        return true;
                    },
                    error: function () {
                        alert("Error while updating data");
                    }
                });
                return false;
            });
        });
    </script>
</body>
</html>
